<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="x-ua-compatible" content="IE=edge">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>paging分页组件</title>
    <link rel="stylesheet" href="../css/global.css"/>
    <link rel="stylesheet" href="../css/prettify.css"/>
    <style>
    .paging_ul{ margin:10px 0; border:1px solid #ccc; border-bottom:0; }
    .paging_ul li{ padding-left:20px; border-bottom:1px solid #ccc; }
    .paging_ul li span{ display:inline-block; width:180px; }
    .paging_ul li:first-child{ background:#dddddd; }
    </style>
    <script src="../../js/jquery.min.js"></script>
    <script src="../../js/cloudjs.js"></script>
    <script src="../js/prettify.js"></script>
    <script src="../js/global.js"></script>
</head>
<body class="body_bg">
    <div class="comps_header">
        <h2 class="comps_name">paging分页组件</h2>
        <p></p>
    </div>
    <div class="comps_summary">
        <h3>cloudjs(selector).paging([options]) <i class="gray">options={'属性名':'属性值',...}</i></h3>
    </div>
    <div class="detail_content">
        <h4>属性</h4>
        <div class="param_table_box">
            <table class="param_table">
                <tbody>
                    <tr>
                        <th>属性名</th>
                        <th>类型</th>
                        <th>默认值</th>
                        <th>说明</th>
                    </tr>
                    <tr>
                        <td>first</td>
                        <td>string</td>
                        <td></td>
                        <td>首页文字，留空则不显示首页</td>
                    </tr>
                    <tr>
                        <td>prev</td>
                        <td>string</td>
                        <td>上一页</td>
                        <td>上一页文字，留空则不显示上一页</td>
                    </tr>
                    <tr>
                         <td>next</td>
                         <td>string</td>
                         <td>下一页</td>
                         <td>下一页文字，留空则不显示下一页</td>
                    </tr>
                    <tr>
                         <td>last</td>
                         <td>string</td>
                         <td></td>
                         <td>末页文字，留空则不显示末页</td>
                    </tr>
                    <tr>
                         <td>showDetails</td>
                         <td>boolean</td>
                         <td>true</td>
                         <td>是否显示分页后面那一串内容</td>
                    </tr>
                    <tr>
                         <td>showIcons</td>
                         <td>boolean</td>
                         <td>false</td>
                         <td>首末上下页是否用图标</td>
                    </tr>
                    <tr>
                         <td>useSimple</td>
                         <td>boolean</td>
                         <td>false</td>
                         <td>是否采用简单的分页</td>
                    </tr>
                    <tr>
                         <td>totalCounts</td>
                         <td>number</td>
                         <td>1000</td>
                         <td>总记录数</td>
                    </tr>
                    <tr>
                         <td>pageSize</td>
                         <td>number</td>
                         <td>20</td>
                         <td>每页展示的记录数</td>
                    </tr>
                    <tr>
                         <td>pageNum</td>
                         <td>number</td>
                         <td>1</td>
                         <td>当前页码</td>
                    </tr>
                    <tr>
                         <td>visiblePages</td>
                         <td>number</td>
                         <td>5</td>
                         <td>显示的页码数量</td>
                    </tr>
                     <tr>
                         <td>ajaxUrl</td>
                         <td>string</td>
                         <td></td>
                         <td>请求的url，留空则需要在onPageChange事件中发起ajax请求，不留空则组件自动请求ajaxUrl，直接在onPageChange事件中通过data.data获取数据</td>
                    </tr>
                    <tr>
                         <td>params</td>
                         <td>string/object</td>
                         <td></td>
                         <td>请求的参数，查询操作时通过setData方法设置，在onPageChange事件中用data.params获取</td>
                    </tr>
                    <tr>
                         <td>dataType</td>
                         <td>string</td>
                         <td>json</td>
                         <td>请求ajaxUrl返回的数据类型，如果url为空，这个参数也没有意义</td>
                    </tr>
                    <tr>
                         <td>sizeKey</td>
                         <td>string</td>
                         <td>pageSize</td>
                         <td>组件向外传递参数pageSize的key值</td>
                    </tr>
                    <tr>
                         <td>numKey</td>
                         <td>string</td>
                         <td>pageNum</td>
                         <td>组件向外传递参数pageNum的key值</td>
                    </tr>
                    <tr>
                         <td>maskId</td>
                         <td>string</td>
                         <td></td>
                         <td>蒙版层的id，如果不为空，ajax请求返回数据前会在此id区域加一层蒙版效果</td>
                    </tr>
                    <tr>
                         <td>loadImg</td>
                         <td>string</td>
                         <td>../../images/ajax-loading.gif</td>
                         <td>蒙版层加载图片的路径</td>
                    </tr>
                    <tr>
                         <td>disableClass</td>
                         <td>string</td>
                         <td>disabled</td>
                         <td>不可点击时的样式</td>
                    </tr>
                    <tr>
                         <td>activeClass</td>
                         <td>string</td>
                         <td>active</td>
                         <td>当前页码的样式</td>
                    </tr>
                    <tr>
                         <td>onPageChange</td>
                         <td>function(data)</td>
                         <td></td>
                         <td>改变分页时触发，向外传递data.totalCounts,data.pageSize,data.pageNum,data.params和data.data</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    <div class="comps_summary">
        <h3>cloudjs(selector).paging('方法名', [args])</h3>
    </div>
    
    <div class="detail_content">
        <h4>方法</h4>
        <div class="param_table_box">
            <table class="param_table">
                <tbody>
                    <tr>
                        <th>方法名</th>
                        <th>参数</th>
                        <th>说明</th>
                    </tr>
                    <tr>
                        <td>setData</td>
                        <td>对象</td>
                        <td>通过设置对象的参数可以达到刷新/更改/销毁组件，对象的参数和组件里面的属性一样</td>
                    </tr>
                    <tr>
                        <td>getData</td>
                        <td>回调函数</td>
                        <td>获取当前状态下的所有数据</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
        
        
    <div class="detail_content">
        <h4>示例</h4>
        <div>
            <h5>示例1：最简单的调用方式，只需传递totalCounts和ajaxUrl</h5>
<div class="example_html_1">
<div id="page_div1"></div>
</div>
            <script class="example_js_1">
cloudjs('#page_div1').paging({ 
    totalCounts: 596, 
    ajaxUrl:'data/paging_data.json', 
    onPageChange: function(data){
        cloudjs.util.log(data);
    }
});
            </script>
            <script>writeCode('.example_html_1');writeCode('.example_js_1');</script>
        </div>
                
        <div>
            <h5>示例2：同时用两个分页并保持一致，只需把class命名一样</h5>
<div class="example_html_2">
<div class="page_div2"></div>
<div class="page_div2"></div>
</div>
<script class="example_js_2">
cloudjs('.page_div2').paging();
</script>
            <script>writeCode('.example_html_2');writeCode('.example_js_2');</script>
        </div>
        
        <div>
            <h5>示例3：使用简单的分页，useSimple设为true，使用图标，showIcons设为true</h5>
<div class="example_html_3">
<div id="page_div3"></div>
</div>
<script class="example_js_3">
cloudjs('#page_div3').paging({ useSimple: true, showIcons: true });
</script>
            <script>writeCode('.example_html_3');writeCode('.example_js_3');</script>
        </div>

        <div>
            <h5>示例4：分页getData和setData方法的使用</h5>
<div class="example_html_4">

<div id="page_div4"></div>
<input type="button" value="刷新" onclick="refresh()"/>
<input type="button" value="销毁"  onclick="destroy()"/>
<input type="button" value="获取数据" onclick="getData()"/>
<span id="page_message4"></span>
</div>
            <script class="example_js_4">
cloudjs('#page_div4').paging({
    totalCounts: 200,
    pageSize: 15,
    onPageChange: function(data){
        $('#page_message4').text(data.pageNum + '/' + Math.ceil(data.totalCounts / data.pageSize) + data.params);
    }
});
function refresh(selector){
    cloudjs('#page_div4').paging('setData', { totalCounts: 80, pageSize: 12, pageNum: 1, params: 'name=a' });
}
function destroy(){
    cloudjs('#page_div4').paging('setData', { totalCounts: 0 });
    $('#page_message4').empty();
}
function getData(selector){
    cloudjs('#page_div4').paging('getData', function(data){
        $('#page_message4').text('总数：' + data.totalCounts + '，每页记录数：' + data.pageSize + '，当前页码：' + data.pageNum);
    });
}
            </script>
            <script>writeCode('.example_html_4');writeCode('.example_js_4');</script>
        </div>
       
        <div>
            <h5>示例5：一个完整分页的使用</h5>
<div class="example_html_5">
<input type="text" name="keys" /> <input type="button" value="查询" onclick="searchFun(this)" />
<div id="page_data5"></div>
<div id="page_div5"></div>
</div>
<script class="example_js_5">
cloudjs('#page_div5').paging({
    totalCounts: 20000, 
    pageSize: 10,
    maskId: 'page_data5',
    ajaxUrl: 'data/paging_data.json',
    onPageChange: function(data){
        //组件内任何一个按钮的点击和调用组件的setData方法都会自己触发onPageChange
        $('#page_data5').html(createHtml(data));
    }
});
//createHtml函数的作用是把接口中返回的json数组转成对应了html代码
//由于本例请求的是静态数据，所以在此函数中会动态的加入一些数据
function createHtml(obj){
    var _arr = [], _jsonArr = obj.data, _size = obj.pageSize, _num = obj.pageNum,
        _total = obj.totalCounts, _counts = _size, _params = obj.params;
    if(_num == Math.ceil(_total / _size) && _total % _size > 0){
        _counts = _total % _size
    };
    _arr.push('<li>组件自动请求的url：' + obj.url + '</li>')
    for( var i = 0; i< _counts; i ++){
        var _obj = i >= _jsonArr.length ? _jsonArr[0] :  _jsonArr[i],
            _html = '<span>第' + ((_num-1) * _size + i + 1) + '条数据</span>';
        for(var key in _obj){
            _html += '<span>' + _obj[key] + '</span>';
        };
        _arr.push('<li>' + _html + '</li>');   
    };
    return '<ul class="paging_ul">' + _arr.join('') + '</ul>';
}
//点击查询时需要先获取到查询参数和数据总量,通过setData传给组件,在触发onPageChange时就可以直接获取到这些参数
function searchFun(self){
    var _params = $(self).parent().find(":input").serialize(), _counts = 5000;
    cloudjs('#page_div5').paging('setData', { totalCounts: _counts, pageNum: 1, params: _params });
}
</script>
            <script>writeCode('.example_html_5');writeCode('.example_js_5');</script>
        </div>
    </div>
</body>
</html>
